GA Run Data Analysis
================
2025-01-20

- [GA Run Data Analysis](#ga-run-data-analysis)
  - [Project Overview](#project-overview)
    - [Key Concepts:](#key-concepts)
  - [Data Generation Process](#data-generation-process)
    - [Steps to Generate the Data](#steps-to-generate-the-data)
  - [External Data Directory
    Structure](#external-data-directory-structure)
  - [Key Paths](#key-paths)
    - [Project Execution Directory](#project-execution-directory)
    - [Data Directory](#data-directory)
    - [Overriding the Data Path](#overriding-the-data-path)
    - [Output Directory](#output-directory)
  - [Prerequisites](#prerequisites)
  - [Instructions for Running the
    Analysis](#instructions-for-running-the-analysis)
    - [Step 1: Clone the Repository](#step-1-clone-the-repository)
    - [Step 2: Set Up the External Data
      Directory](#step-2-set-up-the-external-data-directory)
    - [Step 3: Open the R Markdown
      File](#step-3-open-the-r-markdown-file)
    - [Step 4: Knit the R Markdown
      File](#step-4-knit-the-r-markdown-file)
  - [Notes on Path Definitions](#notes-on-path-definitions)
  - [Troubleshooting](#troubleshooting)

# GA Run Data Analysis

This project is designed to perform post-analysis on Genetic Algorithm
(GA) run data generated by the LegalNLP project. The analysis is
conducted in **R** using R Markdown to produce detailed HTML reports.

## Project Overview

This repository contains the **R scripts and code** necessary for
analyzing GA run data. However, the **data directory** containing logs,
summaries, and validation files is external and can be defined by the
user.

### Key Concepts:

1.  **Project Execution**: All R scripts and markdown files are located
    in the repository’s `ga_post_processing_R` folder.
2.  **Data Location**: The `TUM_LegalNLP_RunData` directory is
    **external** and user-defined. It contains subdirectories for
    GA-generated data.

## Data Generation Process

The logs, summaries, and validation files in the `TUM_LegalNLP_RunData`
directory are generated using the **`genetic_dln` framework**. This
framework is written in Python and includes modules for running and
validating Genetic Algorithm (GA) configurations.

### Steps to Generate the Data

1.  Clone the main `LegalNLPLab` repository, which contains the
    `genetic_dln` framework:

    ``` bash
    git clone https://github.com/your-username/LegalNLPLab.git
    ```

2.  Install the required Python dependencies (preferably in a virtual
    environment):

    ``` bash
    pip install -r requirements.txt
    ```

There are two options for running a set of run configurations.

3A. **Run GA Configurations and Validate Separately**:

- Step 1: Run GA Configurations

Use the `ga_runner_multiple.py` script to execute multiple Genetic
Algorithm configurations.

This will generate `ga_log_{timestamp}.log` for each configuration, and
a `ga_runs_summary_{timestamp}.json`summary for the entire run:

``` python
genetic_dln/src/ga_runner_multiple.py
```

The `RUN_CONFIGS` variable in the script allows you to define specific
configurations. These configurations temporarily overwrite fields in the
project’s `hyperparameters.yaml` file for the duration of the run.

- Step 2: Validate Best Individuals

After generating the run summary, validate the best individuals using
the `validate_from_summary.py` script. This script reads a summary file
generated in the previous step and produces validation results:

``` python
genetic_dln/src/validate_from_summary.py
```

Ensure that the summary file path is specified correctly in the script.

3B. **Run and Validate Successively**:

To run GA configurations and validate the best individuals in a single
process, use the `ga_runner_validator_multiple.py` script:
`python    genetic_dln/src/ga_runner_validator_multiple.py` This script
combines the functionality of `ga_runner_multiple.py` and
`validate_from_summary.py`, running the GA configurations and
immediately validating the results in sequence.

Similar to the separate process, `RUN_CONFIGS` defines the
configurations for the run and temporarily overwrites fields in
`hyperparameters.yaml`.

5.  **Organize and Move Outputs**:

After running the scripts, the outputs will be stored in the `logs` and
`ga_results` directories of the repository.

These files need to be moved to a user-defined data directory structure
under `run_data` for further analysis. The `run_data` directory should
have the following structure:

- **`logs/`**: Contains the GA log files (`ga_log_*`).
- **`summaries/`**: Contains the run summaries (`ga_runs_summary_*`).
- **`validation/`**: Contains the validation results for the best
  individuals (`*_validation.json`).

6.  Once the data has been generated, organized, and stored in the
    correct directory structure, it can be analyzed using the R Markdown
    report.

Ensure the paths to the data are properly configured in the R Markdown
file (`GA_Runs.Rmd`) as defined in the next sections.

------------------------------------------------------------------------

## External Data Directory Structure

The expected structure of the external `TUM_LegalNLP_RunData` directory
is as follows:

    TUM_LegalNLP_RunData/
    ├── run_data/
    │   ├── logs/             # Directory for GA log files
    │   ├── summaries/        # Directory for GA run summaries
    │   ├── validation/       # Directory for validation results
    ├── run_stats_and_mapping/  # Directory for generated reports (output)

You can set the `TUM_LegalNLP_RunData` directory path dynamically in the
R Markdown script.

## Key Paths

### Project Execution Directory

The **project execution directory** is the root of this repository,
where the R Markdown file (`GA_Runs.Rmd`) is located:

    LegalNLPLab/
    ├── ga_post_processing_R/
    │   ├── GA_Runs.Rmd       # R Markdown file for generating reports
    │   ├── readme.Rmd 
    │   ├── #other helper scripts and executables

### Data Directory

The **data directory** (`TUM_LegalNLP_RunData`) is external and can be
located anywhere. Users need to define its path in the R Markdown file.
The default path is set **relative to the R Markdown file** but can be
overridden.

### Overriding the Data Path

To override the data directory path, update the `user_data_dir` variable
in the R Markdown file to an **absolute path**:

``` r
user_data_dir <- "/path/to/external/TUM_LegalNLP_RunData"
```

If `user_data_dir` is not specified, the script defaults to:

    ../TUM_LegalNLP_RunData/

relative to the R Markdown file.

### Output Directory

Processed outputs, including statistics and mappings, will be saved to
the following directory inside the data directory:

    TUM_LegalNLP_RunData/run_stats_and_mapping/

If this directory doesn’t exist, it will be created automatically during
the analysis.

## Prerequisites

Before running the analysis, ensure the following tools and packages are
installed:

1.  **R** (≥ 4.0.0)
2.  **RStudio** (for running `.Rmd` files)
3.  Required R packages:
    - [`tidyverse`](https://www.tidyverse.org)
    - [`here`](https://here.r-lib.org)
    - [`knitr`](https://yihui.org/knitr/)

To install the necessary packages in R, run:

``` r
install.packages(c("tidyverse", "here", "knitr"))
```

## Instructions for Running the Analysis

### Step 1: Clone the Repository

Clone the repository containing the R Markdown file and related scripts:

``` bash
git clone https://github.com/your-username/LegalNLPLab.git
```

### Step 2: Set Up the External Data Directory

Ensure the `TUM_LegalNLP_RunData` directory exists with the following
structure:

    TUM_LegalNLP_RunData/
    ├── run_data/
    │   ├── logs/             # Directory for GA log files
    │   ├── summaries/        # Directory for GA run summaries
    │   ├── validation/       # Directory for validation results
    ├── run_stats_and_mapping/  # Directory for generated reports (output)

If the data is stored elsewhere, set the `user_data_dir` variable in the
R Markdown file to the absolute path of the data directory.

### Step 3: Open the R Markdown File

Navigate to the `ga_post_processing_R/` directory and open the
`GA_Runs.Rmd` file in RStudio.

``` bash
cd ga_post_processing_R/
```

### Step 4: Knit the R Markdown File

In RStudio, click the “Knit” button or run the following command in the
R console to generate the HTML report:

``` r
rmarkdown::render("GA_Runs.Rmd")
```

This will produce an HTML report summarizing the GA runs, validation
results, and key metrics.

## Notes on Path Definitions

1.  The **`here` package** is used to dynamically define paths based on
    the location of the R Markdown file. This ensures reproducibility
    and makes the analysis portable across systems.
2.  The user can override the data directory (`user_data_dir`) to point
    to any directory structure containing the required input files.

## Troubleshooting

1.  **Data Directory Not Found**: Ensure the `TUM_LegalNLP_RunData`
    directory exists at the correct relative or absolute location.
2.  **Output Directory Not Created**: Check file permissions and ensure
    R has write access to the parent directory.
3.  **Missing R Packages**: Install the required packages using
    `install.packages()` as shown above.
